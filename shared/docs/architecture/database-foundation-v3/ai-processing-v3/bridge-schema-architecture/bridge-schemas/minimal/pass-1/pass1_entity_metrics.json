{
  "table": "pass1_entity_metrics",
  "pass": "pass-1",
  "required": ["profile_id", "shell_file_id", "processing_session_id", "entities_detected", "processing_time_ms", "processing_time_minutes", "vision_model_used"],
  "fields": {
    "profile_id": "uuid (context, cross-pass join key)",
    "shell_file_id": "uuid (source document)",
    "processing_session_id": "uuid (PRIMARY cross-pass join key)",
    "entities_detected": "integer (NOT NULL, entity count)",
    "processing_time_ms": "integer (NOT NULL, consistent across passes)",
    "processing_time_minutes": "numeric(10,2) (NOT NULL, GENERATED, auto-calculated from ms / 60000)",
    "vision_model_used": "string (NOT NULL)",
    "ocr_model_used": "string? (optional)",
    "ocr_agreement_average": "numeric(4,3)? 0.000-1.000",
    "confidence_distribution": "jsonb? (e.g., {high: 18, medium: 5, low: 2})",
    "entity_types_found": "string[]? (entity categories)",
    "input_tokens": "integer? (prompt_tokens from API, text + images)",
    "output_tokens": "integer? (completion_tokens from API)",
    "total_tokens": "integer? (sum of input + output)",
    "ocr_pages_processed": "integer?",
    "user_agent": "string?",
    "ip_address": "inet?"
  },
  "quality_indicators": {
    "high": "ocr_agreement >= 0.900, conf.high >= 70% entities",
    "moderate": "ocr_agreement 0.750-0.899 OR conf.high >= 50%",
    "low": "ocr_agreement < 0.750 OR conf.low > 25%"
  },
  "cross_pass_naming": {
    "pass1": "entities_detected",
    "pass2": "clinical_entities_enriched",
    "pass3": "(planned) narratives_generated"
  },
  "cross_pass_keys": {
    "processing_session_id": "Primary join for rollup analytics",
    "profile_id": "Per-patient aggregation",
    "shell_file_id": "Per-document tracking"
  },
  "example": {
    "profile_id": "uuid-from-context",
    "shell_file_id": "uuid-of-processed-document",
    "processing_session_id": "uuid-of-ai-session",
    "entities_detected": 25,
    "processing_time_ms": 1800,
    "processing_time_minutes": 0.03,
    "vision_model_used": "gpt-4o",
    "ocr_agreement_average": 0.920,
    "confidence_distribution": {
      "high": 18,
      "medium": 5,
      "low": 2
    },
    "entity_types_found": ["medication", "condition", "vital_sign", "observation"],
    "input_tokens": 1800,
    "output_tokens": 700,
    "total_tokens": 2500
  }
}
