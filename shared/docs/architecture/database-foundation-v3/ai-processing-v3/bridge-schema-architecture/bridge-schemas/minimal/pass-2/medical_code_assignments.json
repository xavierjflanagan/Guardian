{
  "table": "medical_code_assignments",
  "pass": "pass-2",
  "stage": "step-1.5",
  "process": "Vector search retrieves 10-20 verified candidates → AI selects from candidates only (no free generation)",
  "required": ["entity_table", "entity_id", "patient_id"],
  "fields": {
    "entity_table": "patient_medications|patient_conditions|patient_allergies|patient_vitals|patient_immunizations|patient_interventions|patient_observations|healthcare_encounters|healthcare_timeline_events",
    "entity_id": "uuid (entity record being coded)",
    "patient_id": "uuid (from context)",
    "universal_code_system": "string(20)? (SNOMED|ICD-10|LOINC|RxNorm|CVX|CPT|ATC)",
    "universal_code": "string(50)?",
    "universal_display": "text?",
    "universal_confidence": "numeric(3,2) 0.00-1.00?",
    "regional_code_system": "string(20)? (PBS|MBS|ACIR|ICD-10-CM|NDC|HCPCS)",
    "regional_code": "string(50)?",
    "regional_display": "text?",
    "regional_confidence": "numeric(3,2) 0.00-1.00?",
    "regional_country_code": "char(3)? (ISO 3166-1 alpha-3: AUS, USA, GBR, etc.)",
    "assigned_at": "timestamptz? (NOW())",
    "assigned_by_system": "text? (vector_ai)",
    "requires_review": "boolean? (false)",
    "reviewed_by_user": "boolean? (false)",
    "reviewed_at": "timestamptz?",
    "validation_notes": "text?",
    "clinical_context": "text?",
    "fallback_identifier": "text? (when confidence < 0.60)",
    "assignment_confidence": "numeric(3,2) 0.00-1.00?",
    "created_at": "timestamptz? (NOW())",
    "updated_at": "timestamptz? (NOW())"
  },
  "confidence_thresholds": {
    "auto_accept": "≥0.80",
    "needs_review": "0.60-0.79",
    "use_fallback": "<0.60"
  },
  "parallel_strategy": {
    "ideal": "Both universal + regional assigned",
    "acceptable": "Only universal OR only regional",
    "safe": "Neither - use fallback_identifier"
  },
  "code_system_by_entity": {
    "patient_medications": "RxNorm (universal), PBS/NDC (regional)",
    "patient_conditions": "SNOMED/ICD-10 (universal), ICD-10-CM (regional)",
    "patient_allergies": "SNOMED (universal), regional codes",
    "patient_observations": "LOINC/SNOMED (universal), regional lab codes",
    "patient_interventions": "CPT/SNOMED (universal), MBS (regional)"
  },
  "example": {
    "entity_table": "patient_medications",
    "entity_id": "uuid-of-medication-record",
    "patient_id": "uuid-from-context",
    "universal_code_system": "RxNorm",
    "universal_code": "314076",
    "universal_display": "Lisinopril 10 MG Oral Tablet",
    "universal_confidence": 0.95,
    "regional_code_system": "PBS",
    "regional_code": "8254K",
    "regional_display": "Lisinopril tablets 10 mg",
    "regional_confidence": 0.90,
    "regional_country_code": "AUS",
    "assigned_by_system": "vector_ai",
    "requires_review": false,
    "assignment_confidence": 0.93
  }
}