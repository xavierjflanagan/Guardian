{
  "schema_version": "1.0.0",
  "table": "manual_review_queue",
  "pass": "pass-2",
  "operation": "CREATE",
  "description": "Pass 2 CREATE operation for manual_review_queue. OPTIONAL creation of new review items for clinical enrichment concerns. Uses identical table structure as Pass 1 but focuses on clinical accuracy reviews. FINAL BRIDGE SCHEMA IN ENTIRE SERIES.",

  "required_fields": [
    "patient_id",
    "processing_session_id",
    "shell_file_id",
    "review_type",
    "review_title",
    "review_description"
  ],

  "fields": {
    "patient_id": {
      "type": "uuid",
      "source": "context",
      "required": true,
      "example": "uuid-of-patient",
      "guidance": "References user_profiles(id) ON DELETE CASCADE. Same as Pass 1. NOT NULL."
    },

    "processing_session_id": {
      "type": "uuid",
      "source": "context",
      "required": true,
      "example": "uuid-of-session",
      "guidance": "References ai_processing_sessions(id) ON DELETE CASCADE. Same session as Pass 1. NOT NULL."
    },

    "shell_file_id": {
      "type": "uuid",
      "source": "context",
      "required": true,
      "example": "uuid-of-shell-file",
      "guidance": "References shell_files(id) ON DELETE CASCADE. Same as Pass 1. NOT NULL."
    },

    "review_type": {
      "type": "enum",
      "values": ["entity_validation", "profile_classification", "clinical_accuracy", "safety_concern", "low_confidence", "contamination_risk"],
      "required": true,
      "examples": ["clinical_accuracy"],
      "guidance": "NOT NULL. Pass 2 typically uses 'clinical_accuracy' to distinguish from Pass 1 reviews."
    },

    "priority": {
      "type": "enum",
      "values": ["low", "normal", "high", "urgent", "critical"],
      "default": "normal",
      "examples": ["high", "normal"],
      "guidance": "NOT NULL DEFAULT 'normal'. Pass 2 reviews typically use normal/high (not critical/urgent)."
    },

    "ai_confidence_score": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.680, 0.720],
      "guidance": "NUMERIC(4,3). Clinical enrichment confidence that triggered this review. 0.000-1.000. Optional but recommended."
    },

    "ai_concerns": {
      "type": "text_array",
      "examples": [["ambiguous_clinical_context", "missing_date_information"], ["multiple_possible_codes", "unclear_severity"]],
      "guidance": "TEXT[]. Pass 2-specific concerns (clinical context, coding, temporal relationships). Optional."
    },

    "flagged_issues": {
      "type": "text_array",
      "examples": [["incomplete_clinical_event"], ["coding_uncertainty"]],
      "guidance": "TEXT[]. Business/clinical issues flagged during enrichment. Optional."
    },

    "review_title": {
      "type": "string",
      "required": true,
      "examples": ["Clinical Enrichment Uncertainty - Medication Timing", "ICD-10 Coding Ambiguity - Hypertension"],
      "guidance": "TEXT NOT NULL. Short summary of clinical review requirement."
    },

    "review_description": {
      "type": "string",
      "required": true,
      "examples": ["Detected medication 'Metformin 500mg' but unable to determine start date or frequency with sufficient confidence. Context suggests 'twice daily' but text is ambiguous. Clinical enrichment confidence: 68%."],
      "guidance": "TEXT NOT NULL. Detailed explanation of clinical uncertainty."
    },

    "ai_suggestions": {
      "type": "string",
      "examples": ["Verify medication timing and frequency. Check surrounding context for date indicators.", "Determine if essential or secondary hypertension based on document context."],
      "guidance": "TEXT. What AI recommends clinical reviewer should focus on. Optional but strongly recommended."
    },

    "clinical_context": {
      "type": "jsonb",
      "default": "{}",
      "examples": [
        {"entity_id": "entity_025", "pass2_confidence": 0.680, "missing_fields": ["start_date", "frequency"]},
        {"entity_id": "entity_048", "possible_codes": ["I10", "I15.0", "I15.9"], "code_confidence": {"I10": 0.72}}
      ],
      "guidance": "JSONB DEFAULT '{}'. Pass 2 clinical metadata (entity_id, pass2_confidence, missing_fields, possible_codes). Optional."
    },

    "assigned_reviewer": {
      "type": "string",
      "examples": ["clinical_review_team", "medical_coding_specialists"],
      "guidance": "TEXT. User identifier or role for clinical review assignment. Optional."
    },

    "assigned_at": {
      "type": "timestamptz",
      "examples": ["2025-01-01T12:35:10Z"],
      "guidance": "TIMESTAMPTZ. When clinical review was assigned. Optional."
    },

    "estimated_review_time": {
      "type": "interval",
      "default": "15 minutes",
      "examples": ["00:08:00"],
      "guidance": "INTERVAL DEFAULT '15 minutes'. Estimated time for clinical review. Optional."
    },

    "review_status": {
      "type": "enum",
      "values": ["pending", "in_review", "completed", "escalated", "deferred"],
      "default": "pending",
      "guidance": "NOT NULL DEFAULT 'pending'. Pass 2 sets 'pending'. Reviewer updates during/after review."
    }
  },

  "fields_not_set_by_pass2": [
    "reviewer_decision",
    "reviewer_notes",
    "modifications_required",
    "review_started_at",
    "review_completed_at",
    "actual_review_time",
    "review_quality_score",
    "reviewer_confidence"
  ],

  "extraction_guidelines": {
    "operation": "CREATE new review queue items for clinical enrichment concerns (OPTIONAL)",
    "pass2_responsibility": "Flag clinical accuracy issues, coding ambiguity, temporal uncertainty, incomplete clinical events",
    "optional_creation": "Only create if clinical enrichment confidence is below threshold",
    "non_blocking": "Pass 2 reviews typically do NOT block processing (unlike Pass 1 critical/urgent)",
    "review_type_focus": "Use 'clinical_accuracy' to distinguish from Pass 1 entity detection reviews",
    "clinical_context_importance": "Include entity_id, pass2_confidence, missing_fields for clinical reviewer"
  },

  "validation_rules": {
    "same_as_pass1": "All validation rules identical to Pass 1 - same table structure",
    "review_type_recommendation": "Pass 2 should primarily use 'clinical_accuracy'",
    "priority_guidance": "Pass 2 reviews typically use 'normal' or 'high' (not 'critical' or 'urgent')"
  }
}
