{
  "schema_version": "1.0.0",
  "table": "profile_appointments",
  "pass": "pass-2",
  "description": "Profile appointments and healthcare visit scheduling including appointment dates, providers, facilities, and visit types. Supports calendar integration and reminder management.",
  "clinical_context": "Use this schema for extracting appointment and healthcare visit scheduling information from medical documents. This table is primarily populated through appointment scheduling workflows, but appointment information may be extracted from medical documents (e.g., referral letters, appointment confirmations) to create or update appointment records.",

  "required_fields": [
    "profile_id",
    "account_owner_id",
    "appointment_date",
    "appointment_type"
  ],

  "fields": {
    "profile_id": {
      "type": "uuid",
      "source": "context",
      "description": "Profile identifier from processing context",
      "required": true,
      "example": "uuid-from-context",
      "guidance": "References user_profiles(id). NOT patient_id - this table uses profile_id."
    },

    "account_owner_id": {
      "type": "uuid",
      "source": "context",
      "description": "Account owner identifier (denormalized for performance)",
      "required": true,
      "example": "uuid-from-auth-context",
      "guidance": "References auth.users(id). Denormalized from profile for query performance."
    },

    "appointment_date": {
      "type": "timestamptz",
      "format": "ISO 8601 with timezone (YYYY-MM-DDTHH:MM:SSZ)",
      "description": "Date and time of appointment",
      "required": true,
      "examples": [
        "2025-10-15T14:30:00Z",
        "2025-10-20T10:00:00Z",
        "2025-10-25T09:00:00Z"
      ],
      "guidance": "TIMESTAMPTZ includes date, time, and timezone. Extract exact appointment time if available."
    },

    "appointment_type": {
      "type": "string",
      "description": "Type of appointment",
      "required": true,
      "examples": [
        "General Checkup",
        "Cardiology Consultation",
        "Pediatric Vaccination",
        "Follow-up Visit",
        "Specialist Referral",
        "Annual Physical"
      ],
      "guidance": "Free-text field describing appointment type. Extract as stated in document."
    },

    "provider_name": {
      "type": "string",
      "description": "Healthcare provider name",
      "required": false,
      "examples": [
        "Dr. Sarah Johnson",
        "Dr. Michael Chen, Cardiologist",
        "Dr. Emily Williams, Pediatrician",
        "Nurse Practitioner Williams"
      ],
      "guidance": "Extract provider name and specialty/credentials if stated."
    },

    "facility_name": {
      "type": "string",
      "description": "Healthcare facility name",
      "required": false,
      "examples": [
        "City Medical Center",
        "Heart Health Specialists",
        "Children's Health Clinic",
        "Community Hospital"
      ],
      "guidance": "Extract facility or clinic name where appointment is scheduled."
    },

    "appointment_duration_minutes": {
      "type": "integer",
      "description": "Duration of appointment in minutes",
      "required": false,
      "examples": [15, 30, 45, 60],
      "guidance": "INTEGER type. Extract if appointment duration is specified."
    },

    "status": {
      "type": "enum",
      "values": ["scheduled", "confirmed", "completed", "cancelled", "no_show"],
      "description": "Current status of appointment",
      "required": false,
      "default": "scheduled",
      "status_definitions": {
        "scheduled": "Appointment scheduled but not yet confirmed",
        "confirmed": "Appointment confirmed by provider or patient",
        "completed": "Appointment completed",
        "cancelled": "Appointment cancelled",
        "no_show": "Patient did not show up for appointment"
      },
      "guidance": "Database has CHECK constraint with default 'scheduled'. Extract if appointment status is clearly stated."
    },

    "chief_complaint": {
      "type": "string",
      "description": "Primary reason for appointment (clinical)",
      "required": false,
      "examples": [
        "Annual physical examination",
        "Follow-up for hypertension management",
        "18-month vaccination",
        "Chest pain evaluation",
        "Diabetes management"
      ],
      "guidance": "Clinical reason for the visit. Extract from referral letters or appointment notes."
    },

    "appointment_notes": {
      "type": "string",
      "description": "Additional appointment notes (administrative)",
      "required": false,
      "examples": [
        "Bring recent blood pressure readings",
        "Fasting required before appointment",
        "Patient requested morning appointment",
        "Interpreter services arranged"
      ],
      "guidance": "Administrative notes about the appointment. Distinct from chief_complaint (clinical)."
    },

    "reminder_preferences": {
      "type": "jsonb",
      "description": "Reminder settings for appointment",
      "required": false,
      "default": "{}",
      "examples": [
        {"email": true, "sms": true, "days_before": 1},
        {"email": false, "sms": true, "hours_before": 24},
        {}
      ],
      "guidance": "JSONB object for flexible reminder configuration. Defaults to empty object."
    },

    "visible_to_primary_account": {
      "type": "boolean",
      "description": "Whether appointment is visible to primary account holder",
      "required": false,
      "default": true,
      "guidance": "Boolean with default TRUE. Privacy setting for shared accounts."
    },

    "requires_guardian_consent": {
      "type": "boolean",
      "description": "Whether guardian consent is required",
      "required": false,
      "default": false,
      "guidance": "Boolean with default FALSE. Set to true for minor/dependent appointments requiring consent."
    },

    "calendar_event_id": {
      "type": "string",
      "description": "External calendar integration ID",
      "required": false,
      "examples": ["google-calendar-event-123", "outlook-event-456"],
      "guidance": "External calendar system event identifier for integration."
    },

    "provider_system_id": {
      "type": "string",
      "description": "Provider's appointment system ID",
      "required": false,
      "examples": ["EPIC-APT-789", "CERNER-123456"],
      "guidance": "Provider's internal appointment system identifier for integration."
    }
  },

  "examples": [
    {
      "description": "General medical checkup appointment",
      "extraction": {
        "profile_id": "uuid-from-context",
        "account_owner_id": "uuid-from-auth-context",
        "appointment_date": "2025-10-15T14:30:00Z",
        "appointment_type": "General Checkup",
        "provider_name": "Dr. Sarah Johnson",
        "facility_name": "City Medical Center",
        "appointment_duration_minutes": 30,
        "status": "scheduled",
        "chief_complaint": "Annual physical examination",
        "visible_to_primary_account": true,
        "requires_guardian_consent": false
      }
    },
    {
      "description": "Specialist consultation with appointment notes",
      "extraction": {
        "profile_id": "uuid-from-context",
        "account_owner_id": "uuid-from-auth-context",
        "appointment_date": "2025-10-20T10:00:00Z",
        "appointment_type": "Cardiology Consultation",
        "provider_name": "Dr. Michael Chen, Cardiologist",
        "facility_name": "Heart Health Specialists",
        "appointment_duration_minutes": 60,
        "status": "confirmed",
        "chief_complaint": "Follow-up for hypertension management",
        "appointment_notes": "Bring recent blood pressure readings",
        "visible_to_primary_account": true
      }
    },
    {
      "description": "Pediatric appointment requiring guardian consent",
      "extraction": {
        "profile_id": "uuid-from-context",
        "account_owner_id": "uuid-from-auth-context",
        "appointment_date": "2025-10-25T09:00:00Z",
        "appointment_type": "Pediatric Vaccination",
        "provider_name": "Dr. Emily Williams, Pediatrician",
        "facility_name": "Children's Health Clinic",
        "appointment_duration_minutes": 15,
        "status": "scheduled",
        "chief_complaint": "18-month vaccination",
        "visible_to_primary_account": true,
        "requires_guardian_consent": true
      }
    }
  ],

  "extraction_guidelines": {
    "not_typically_extracted": "This table is primarily populated through appointment scheduling workflows, NOT from AI document extraction. However, appointment information may be extracted from referral letters, appointment confirmations, or discharge summaries.",
    "timestamptz_format": "appointment_date is TIMESTAMPTZ (not DATE). Extract both date and time if available. If only date is mentioned, append default time (e.g., 'T00:00:00Z').",
    "status_inference": "If document is a future appointment confirmation, status is likely 'scheduled' or 'confirmed'. If from past records, status is likely 'completed'.",
    "chief_complaint_vs_notes": "chief_complaint is the clinical reason (medical). appointment_notes are administrative details (logistics, preparation).",
    "guardian_consent": "For child/dependent profiles, set requires_guardian_consent=true if appointment involves procedures requiring parental consent.",
    "duration_extraction": "Extract appointment_duration_minutes only if explicitly stated (e.g., '30-minute appointment').",
    "integration_fields": "calendar_event_id and provider_system_id are typically system-generated, not extracted from documents."
  },

  "validation_rules": {
    "profile_id": "Must be valid UUID from context (NOT NULL)",
    "account_owner_id": "Must be valid UUID from auth context (NOT NULL)",
    "appointment_date": "Must be valid ISO 8601 TIMESTAMPTZ format (NOT NULL)",
    "appointment_type": "Must be provided (NOT NULL)",
    "status": "If provided, must be one of: 'scheduled', 'confirmed', 'completed', 'cancelled', 'no_show'",
    "appointment_duration_minutes": "If provided, must be positive integer",
    "reminder_preferences": "If provided, must be valid JSONB object",
    "boolean_fields": "visible_to_primary_account and requires_guardian_consent must be boolean (true/false)"
  }
}
