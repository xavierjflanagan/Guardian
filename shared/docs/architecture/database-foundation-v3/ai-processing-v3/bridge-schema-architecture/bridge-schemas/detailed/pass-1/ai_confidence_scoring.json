{
  "schema_version": "1.0.0",
  "table": "ai_confidence_scoring",
  "pass": "pass-1",
  "operation": "CREATE",
  "description": "Pass 1 CREATE operation for ai_confidence_scoring. Tracks entity detection confidence metrics at session-level or entity-level. Used for quality monitoring, manual review triggering, and model performance tracking.",

  "required_fields": [
    "processing_session_id"
  ],

  "fields": {
    "processing_session_id": {
      "type": "uuid",
      "source": "context",
      "required": true,
      "example": "uuid-of-session",
      "guidance": "References ai_processing_sessions(id) ON DELETE CASCADE. NOT NULL. Which session this confidence scoring belongs to."
    },

    "entity_processing_audit_id": {
      "type": "uuid",
      "source": "context",
      "examples": ["uuid-of-entity-audit"],
      "guidance": "References entity_processing_audit(id) ON DELETE CASCADE. Optional. If provided, this is entity-level scoring; if NULL, this is session-level scoring."
    },

    "entity_detection_confidence": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.885, 0.750],
      "guidance": "NUMERIC(4,3). Confidence in entity detection. 0.000-1.000. Optional but recommended."
    },

    "text_extraction_confidence": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.920, 0.680],
      "guidance": "NUMERIC(4,3). OCR/text extraction quality. 0.000-1.000. Optional but recommended."
    },

    "spatial_alignment_confidence": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.850, 0.720],
      "guidance": "NUMERIC(4,3). Bounding box accuracy. 0.000-1.000. Optional."
    },

    "vision_model_confidence": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.910, 0.740],
      "guidance": "NUMERIC(4,3). Vision model (GPT-4o, etc.) confidence. 0.000-1.000. Optional."
    },

    "language_model_confidence": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.875, 0.760],
      "guidance": "NUMERIC(4,3). Language model text understanding confidence. 0.000-1.000. Optional."
    },

    "classification_model_confidence": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.890, 0.750],
      "guidance": "NUMERIC(4,3). Entity classification confidence. 0.000-1.000. Optional."
    },

    "overall_confidence": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.885, 0.740],
      "guidance": "NUMERIC(4,3). Weighted average of component scores. 0.000-1.000. Optional but recommended for manual review triggering."
    },

    "reliability_score": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.900, 0.720],
      "guidance": "NUMERIC(4,3). Consistency/reproducibility metric. 0.000-1.000. Optional."
    },

    "clinical_relevance_score": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.870, 0.950],
      "guidance": "NUMERIC(4,3). Medical importance scoring. 0.000-1.000. Optional."
    },

    "confidence_trend": {
      "type": "enum",
      "values": ["improving", "stable", "declining"],
      "examples": ["stable", "declining"],
      "guidance": "Trend over time (may require historical comparison). Optional."
    },

    "outlier_detection": {
      "type": "boolean",
      "default": false,
      "examples": [false, true],
      "guidance": "Flag for unusual confidence patterns. Defaults to FALSE."
    },

    "confidence_flags": {
      "type": "text_array",
      "examples": [["low_ocr_confidence", "spatial_uncertainty"], ["handwriting_present"]],
      "guidance": "TEXT[]. Quality issue flags. Optional but recommended for diagnostics."
    },

    "human_validation_available": {
      "type": "boolean",
      "default": false,
      "examples": [false, true],
      "guidance": "Whether human review data is available. Defaults to FALSE."
    },

    "human_agreement_score": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.975],
      "guidance": "NUMERIC(4,3). Agreement between AI and human. 0.000-1.000. Optional, populate if human_validation_available=true."
    },

    "model_accuracy_score": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.980],
      "guidance": "NUMERIC(4,3). Model accuracy metric. 0.000-1.000. Optional."
    },

    "processing_time_ms": {
      "type": "integer",
      "examples": [8450, 2100],
      "guidance": "Processing time in milliseconds. Optional but recommended for performance monitoring."
    },

    "model_version": {
      "type": "string",
      "examples": ["gpt-4o-mini-2024-07-18", "claude-3-5-sonnet-20241022"],
      "guidance": "AI model version identifier. Optional but recommended for model tracking."
    },

    "calibration_score": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.910, 0.985],
      "guidance": "NUMERIC(4,3). Model calibration quality. 0.000-1.000. Optional."
    }
  },

  "fields_not_set_by_pass1": [
    "clinical_coding_confidence"
  ],

  "extraction_guidelines": {
    "operation": "CREATE one confidence record per session OR per entity",
    "session_vs_entity": "If entity_processing_audit_id is NULL, this is session-level; if provided, this is entity-level",
    "pass1_responsibility": "Track entity detection confidence and quality metrics",
    "optional_nature": "Only processing_session_id is required; all other fields are optional",
    "confidence_calculation": "Use weighted average for overall_confidence; variance for reliability_score",
    "manual_review_trigger": "Use overall_confidence < threshold to flag for human review",
    "model_monitoring": "Track processing_time_ms and calibration_score over time"
  },

  "validation_rules": {
    "processing_session_id": "Must be valid UUID (NOT NULL)",
    "entity_processing_audit_id": "If provided, must be valid UUID",
    "all_confidence_scores": "If provided, must be 0.000-1.000 (NUMERIC 4,3)",
    "confidence_trend": "If provided, must be 'improving', 'stable', or 'declining'",
    "outlier_detection": "Defaults to FALSE if not provided",
    "human_validation_available": "Defaults to FALSE if not provided",
    "processing_time_ms": "If provided, must be positive integer",
    "confidence_flags": "If provided, must be TEXT[] array"
  }
}
