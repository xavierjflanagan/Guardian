{
  "schema_version": "1.0.0",
  "table": "ai_confidence_scoring",
  "pass": "pass-2",
  "operation": "UPDATE",
  "description": "Pass 2 UPDATE operation for ai_confidence_scoring. OPTIONAL updates to add clinical enrichment confidence metrics. Unlike other multi-pass tables, Pass 2 participation here is entirely optional and additive.",

  "fields_pass2_may_update": {
    "clinical_coding_confidence": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.920, 0.650],
      "guidance": "NUMERIC(4,3). Clinical classification confidence from Pass 2 enrichment. 0.000-1.000. Optional."
    },

    "overall_confidence": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.895],
      "guidance": "NUMERIC(4,3). MAY recalculate to incorporate both Pass 1 and Pass 2 confidence. 0.000-1.000. Optional."
    },

    "reliability_score": {
      "type": "numeric",
      "precision": 4,
      "scale": 3,
      "range": [0, 1],
      "examples": [0.910],
      "guidance": "NUMERIC(4,3). MAY update with Pass 2 validation data. 0.000-1.000. Optional."
    },

    "confidence_flags": {
      "type": "text_array",
      "examples": [["pass2_low_clinical_confidence", "missing_context"]],
      "guidance": "TEXT[]. MAY append Pass 2-specific quality flags. Use array_append() to preserve Pass 1 flags. Optional."
    }
  },

  "fields_not_modified_by_pass2": [
    "processing_session_id",
    "entity_processing_audit_id",
    "entity_detection_confidence",
    "text_extraction_confidence",
    "spatial_alignment_confidence",
    "vision_model_confidence",
    "language_model_confidence",
    "classification_model_confidence",
    "clinical_relevance_score",
    "confidence_trend",
    "outlier_detection",
    "human_validation_available",
    "human_agreement_score",
    "model_accuracy_score",
    "processing_time_ms",
    "model_version",
    "calibration_score"
  ],

  "examples": [
    {
      "description": "Add clinical coding confidence only",
      "update": {
        "clinical_coding_confidence": 0.920
      }
    },
    {
      "description": "Add clinical confidence and update overall",
      "update": {
        "clinical_coding_confidence": 0.880,
        "overall_confidence": 0.895
      }
    },
    {
      "description": "Add Pass 2 quality flag",
      "update": {
        "clinical_coding_confidence": 0.650,
        "confidence_flags": ["pass2_low_clinical_confidence", "missing_context"]
      }
    },
    {
      "description": "No Pass 2 update (optional operation)",
      "update": null
    }
  ],

  "update_guidelines": {
    "operation": "UPDATE existing confidence record (Pass 1 created it)",
    "optional_nature": "Pass 2 updates are ENTIRELY OPTIONAL - many deployments may skip them",
    "additive_updates": "Pass 2 ADDS clinical_coding_confidence, does not replace Pass 1 metrics",
    "overall_recalculation": "If updating overall_confidence, incorporate both Pass 1 and Pass 2 scores using weighted average",
    "confidence_flags_append": "Use array_append() to ADD Pass 2 flags without removing Pass 1 flags",
    "readonly_pass1": "Do NOT modify any Pass 1 confidence metrics",
    "no_status_tracking": "Unlike other multi-pass tables, no explicit pass2_status field exists",
    "use_case_driven": "Only update if clinical enrichment confidence is meaningful for quality tracking"
  },

  "validation_rules": {
    "clinical_coding_confidence": "If provided, must be 0.000-1.000",
    "overall_confidence": "If updated, must be 0.000-1.000 and incorporate both Pass 1 and Pass 2",
    "reliability_score": "If updated, must be 0.000-1.000",
    "confidence_flags": "If updated, must preserve existing Pass 1 flags (use array_append)",
    "pass1_fields_readonly": "All Pass 1 fields must NOT be modified",
    "where_clause": "Target correct confidence record by id"
  }
}
